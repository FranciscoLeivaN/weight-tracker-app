name: Pruebas End-to-End

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  cypress-run:
    name: Ejecutar pruebas E2E con Cypress
    runs-on: ubuntu-latest
    
    steps:
    - name: Obtener código
      uses: actions/checkout@v4
      
    - name: Configurar Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: Instalar dependencias
      run: npm ci
      
    # Ejecutamos únicamente las pruebas E2E sin incluir pruebas de rendimiento
    - name: Ejecutar pruebas E2E Cypress
      uses: cypress-io/github-action@v6
      with:
        start: npm start
        wait-on: 'http://localhost:3000'
        wait-on-timeout: 120
        browser: chrome
        spec: cypress/e2e/weightTracker.cy.js
        record: false
        config: video=true,screenshotOnRunFailure=true
      env:
        CI: true
        CYPRESS_baseUrl: http://localhost:3000
        # Configuraciones específicas para CI
        ELECTRON_EXTRA_LAUNCH_ARGS: "--disable-gpu"
        CYPRESS_CHROME_ARGS: "--no-sandbox,--disable-gpu,--disable-dev-shm-usage,--disable-setuid-sandbox,--no-first-run,--disable-extensions"
        
    # Ejecutar el archivo placeholder para pruebas de rendimiento
    - name: Ejecutar prueba placeholder de rendimiento
      run: npm run test:ci:performance
      env:
        CI: true
